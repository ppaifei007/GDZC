<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全国固定资产投资累计增幅统计 | 2001年至今</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0F766E',
                        secondary: '#7F1D1D',
                        accent: '#3B82F6',
                        neutral: '#1F2937',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
            }
            .gradient-bg {
                background: linear-gradient(135deg, #0F766E 0%, #047857 100%);
            }
            .stat-card-hover {
                transition: all 0.3s ease;
            }
            .stat-card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .update-badge {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.6; }
                100% { opacity: 1; }
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-neutral">
    <!-- 导航栏 -->
    <header class="gradient-bg text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fa fa-line-chart text-3xl mr-3 text-green-200"></i>
                    <h1 class="text-[clamp(1.5rem,3vw,2.2rem)] font-bold">全国固定资产投资累计增幅统计</h1>
                </div>
                <div class="flex items-center">
                    <span id="last-update" class="hidden md:inline-block bg-white/20 px-3 py-1 rounded-full text-sm mr-4">
                        数据更新至: <span id="update-date">加载中...</span>
                        <span id="new-update-indicator" class="ml-2 bg-green-400 text-white text-xs px-1.5 py-0.5 rounded update-badge hidden">
                            新更新
                        </span>
                    </span>
                    <button id="update-btn" class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center" disabled>
                        <i class="fa fa-refresh mr-2"></i>
                        <span>更新数据</span>
                    </button>
                    <button id="info-btn" class="ml-2 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                        <i class="fa fa-info-circle mr-2"></i>
                        <span class="hidden sm:inline">指标说明</span>
                    </button>
                </div>
            </div>
            <p class="mt-2 text-white/80">2001年至今全国固定资产投资累计同比增幅趋势分析 (%) | 采用当年累计口径计算</p>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 数据摘要卡片 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl card-shadow p-6 stat-card-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-gray-500 font-medium">统计年份</h3>
                    <i class="fa fa-calendar-check-o text-primary text-xl"></i>
                </div>
                <p id="total-years" class="text-3xl font-bold">加载中...</p>
                <p class="text-gray-400 text-sm mt-2">自2001年起</p>
            </div>
            
            <div class="bg-white rounded-xl card-shadow p-6 stat-card-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-gray-500 font-medium">年均累计增幅</h3>
                    <i class="fa fa-arrows-h text-primary text-xl"></i>
                </div>
                <p id="average-growth" class="text-3xl font-bold">加载中...</p>
                <p class="text-gray-400 text-sm mt-2">各年度全年累计平均值</p>
            </div>
            
            <div class="bg-white rounded-xl card-shadow p-6 stat-card-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-gray-500 font-medium">最高累计增幅</h3>
                    <i class="fa fa-arrow-up text-green-500 text-xl"></i>
                </div>
                <p id="max-growth" class="text-3xl font-bold">加载中...</p>
                <p id="max-year" class="text-gray-400 text-sm mt-2">记录年份</p>
            </div>
            
            <div class="bg-white rounded-xl card-shadow p-6 stat-card-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-gray-500 font-medium">最新累计增幅</h3>
                    <i class="fa fa-bar-chart text-accent text-xl"></i>
                </div>
                <p id="latest-growth" class="text-3xl font-bold">加载中...</p>
                <p id="latest-period" class="text-gray-400 text-sm mt-2">2025年1-6月累计</p>
            </div>
        </div>
        
        <!-- 图表说明 -->
        <div class="bg-white rounded-xl card-shadow p-4 mb-6 flex flex-wrap items-center">
            <div class="flex items-center mr-6 mb-2 md:mb-0">
                <div class="w-4 h-4 bg-primary rounded-sm mr-2"></div>
                <span class="text-sm text-gray-600">固定资产投资累计增幅 (%)</span>
            </div>
            <div class="flex items-center mr-6 mb-2 md:mb-0">
                <div class="w-4 h-0.5 bg-secondary mr-2"></div>
                <span class="text-sm text-gray-600">重要经济事件</span>
            </div>
            <div class="text-sm text-gray-500">
                <i class="fa fa-info-circle text-accent mr-1"></i>
                数据为当年累计固定资产投资同比增长率，即1-本月累计投资额与上年同期相比的增幅
            </div>
        </div>
        
        <!-- 图表控制和显示区域 -->
        <div class="bg-white rounded-xl card-shadow p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold mb-2">全国固定资产投资累计增幅趋势 (2001年至今)</h2>
                    <p class="text-gray-500">当年累计固定资产投资同比增长率 (%) 变化趋势（1-本月累计）</p>
                </div>
                <div class="mt-4 md:mt-0 flex flex-wrap gap-2">
                    <button class="time-filter-btn px-4 py-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-100 transition-all" data-interval="yearly" disabled>年度视图</button>
                    <button class="time-filter-btn active px-4 py-2 rounded-lg border border-primary text-primary bg-primary/10 hover:bg-primary/20 transition-all" data-interval="5years" disabled>5年视图</button>
                    <button class="time-filter-btn px-4 py-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-100 transition-all" data-interval="all" disabled>完整视图</button>
                </div>
            </div>
            
            <div class="h-[500px] w-full flex items-center justify-center" id="chart-container">
                <div id="chart-loading" class="text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"></div>
                    <p>正在加载图表...</p>
                </div>
                <div id="chart-error" class="text-center hidden">
                    <i class="fa fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>
                    <p class="mb-2">图表加载失败</p>
                    <div class="space-y-2">
                        <button id="retry-chart" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-300 text-sm">
                            重试加载图表
                        </button>
                        <button id="fallback-chart" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-all duration-300 text-sm">
                            加载简化版图表
                        </button>
                    </div>
                </div>
                <canvas id="investmentChart" class="hidden"></canvas>
            </div>
        </div>
        
        <!-- 年度累计数据表格 -->
        <div class="bg-white rounded-xl card-shadow p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fa fa-table text-accent mr-2"></i>
                各年度累计增幅数据
            </h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">年份</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">1-3月</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">1-6月</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">1-9月</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">1-12月</th>
                        </tr>
                    </thead>
                    <tbody id="yearly-data" class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                正在加载年度数据...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 数据更新历史 -->
        <div class="bg-white rounded-xl card-shadow p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fa fa-history text-accent mr-2"></i>
                数据更新历史
            </h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">更新时间</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">累计月份</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">累计增幅(%)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">与上月累计比较</th>
                        </tr>
                    </thead>
                    <tbody id="update-history" class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                                正在加载历史数据...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 经济事件时间线 -->
        <div class="bg-white rounded-xl card-shadow p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6">重要经济事件与投资趋势关联</h2>
            <div class="relative">
                <!-- 时间线轴线 -->
                <div class="absolute h-full w-0.5 bg-gray-200 left-4 md:left-1/2 transform md:-translate-x-1/2"></div>
                
                <!-- 时间线事件 -->
                <div class="space-y-8">
                    <div class="relative flex flex-col md:flex-row items-start">
                        <div class="flex md:w-1/2 md:justify-end pr-8 md:pr-12 mb-4 md:mb-0">
                            <div class="text-right">
                                <h3 class="text-lg font-semibold text-primary">加入WTO后投资增长</h3>
                                <p class="text-gray-600 mt-1">2001-2007年</p>
                                <p class="text-gray-500 text-sm mt-2">加入WTO后，外资流入增加，基础设施投资加速，固定资产投资累计增幅保持两位数增长。</p>
                            </div>
                        </div>
                        <div class="absolute left-2 md:left-1/2 transform md:-translate-x-1/2 w-6 h-6 rounded-full bg-secondary flex items-center justify-center z-10">
                            <i class="fa fa-flag text-white text-xs"></i>
                        </div>
                        <div class="md:w-1/2 pl-8 md:pl-12"></div>
                    </div>
                    
                    <div class="relative flex flex-col md:flex-row items-start">
                        <div class="md:w-1/2 md:justify-end pr-8 md:pr-12"></div>
                        <div class="absolute left-2 md:left-1/2 transform md:-translate-x-1/2 w-6 h-6 rounded-full bg-secondary flex items-center justify-center z-10">
                            <i class="fa fa-area-chart text-white text-xs"></i>
                        </div>
                        <div class="md:w-1/2 pl-8 md:pl-12">
                            <div>
                                <h3 class="text-lg font-semibold text-primary">4万亿经济刺激计划</h3>
                                <p class="text-gray-600 mt-1">2008年底</p>
                                <p class="text-gray-500 text-sm mt-2">全球金融危机后，中国推出4万亿经济刺激计划，重点投向基础设施建设，推动投资累计增速回升。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative flex flex-col md:flex-row items-start">
                        <div class="flex md:w-1/2 md:justify-end pr-8 md:pr-12 mb-4 md:mb-0">
                            <div class="text-right">
                                <h3 class="text-lg font-semibold text-primary">供给侧结构性改革</h3>
                                <p class="text-gray-600 mt-1">2015年起</p>
                                <p class="text-gray-500 text-sm mt-2">推进供给侧结构性改革，去产能、去库存、去杠杆，投资累计增速逐步放缓并趋于稳定。</p>
                            </div>
                        </div>
                        <div class="absolute left-2 md:left-1/2 transform md:-translate-x-1/2 w-6 h-6 rounded-full bg-secondary flex items-center justify-center z-10">
                            <i class="fa fa-cogs text-white text-xs"></i>
                        </div>
                        <div class="md:w-1/2 pl-8 md:pl-12"></div>
                    </div>
                    
                    <div class="relative flex flex-col md:flex-row items-start">
                        <div class="md:w-1/2 md:justify-end pr-8 md:pr-12"></div>
                        <div class="absolute left-2 md:left-1/2 transform md:-translate-x-1/2 w-6 h-6 rounded-full bg-secondary flex items-center justify-center z-10">
                            <i class="fa fa-medkit text-white text-xs"></i>
                        </div>
                        <div class="md:w-1/2 pl-8 md:pl-12">
                            <div>
                                <h3 class="text-lg font-semibold text-primary">新冠疫情影响</h3>
                                <p class="text-gray-600 mt-1">2020年至今</p>
                                <p class="text-gray-500 text-sm mt-2">疫情初期投资累计增幅大幅下滑，随后随着经济复苏政策见效，累计投资逐步恢复并保持稳定增长。</p>
                            </div>
                        </div>
                    </div>

                    <div class="relative flex flex-col md:flex-row items-start">
                        <div class="flex md:w-1/2 md:justify-end pr-8 md:pr-12 mb-4 md:mb-0">
                            <div class="text-right">
                                <h3 class="text-lg font-semibold text-primary">经济复苏政策实施</h3>
                                <p class="text-gray-600 mt-1">2024年</p>
                                <p class="text-gray-500 text-sm mt-2">新一轮基础设施投资计划启动，重点支持新基建和绿色能源项目，带动累计投资稳步增长。</p>
                            </div>
                        </div>
                        <div class="absolute left-2 md:left-1/2 transform md:-translate-x-1/2 w-6 h-6 rounded-full bg-secondary flex items-center justify-center z-10">
                            <i class="fa fa-rocket text-white text-xs"></i>
                        </div>
                        <div class="md:w-1/2 pl-8 md:pl-12"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 关于固定资产投资累计增幅 -->
        <div class="bg-white rounded-xl card-shadow p-6">
            <h2 class="text-2xl font-bold mb-4">关于固定资产投资累计增幅</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="col-span-2">
                    <p class="text-gray-700 mb-4"><strong>当年累计口径计算方法：</strong>固定资产投资累计增幅是指当年1月至报告月的累计投资额与上年同期（即上年1月至相同月份）累计投资额相比的增长幅度。</p>
                    <p class="text-gray-700 mb-4">计算公式：累计增幅(%) = [(当年1-本月累计投资额 - 上年1-本月累计投资额) / 上年1-本月累计投资额] × 100%</p>
                    <p class="text-gray-700 mb-4">例如，2025年1-6月累计增幅，是指2025年1-6月的固定资产投资总额与2024年1-6月的固定资产投资总额相比的增长率。</p>
                    <p class="text-gray-700">这种统计方法能够更全面地反映全年投资趋势，平滑月度波动，是国家统计局发布固定资产投资数据时采用的主要口径。</p>
                </div>
                <div class="bg-gray-50 rounded-lg overflow-hidden">
                    <img src="https://picsum.photos/id/1076/600/400" alt="基础设施建设场景，展示固定资产投资的实际应用" class="w-full h-full object-cover">
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-neutral text-white/80 mt-12 py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p>© 2025 全国固定资产投资统计分析平台</p>
                    <p class="text-sm mt-1">数据每月自动更新，最新数据至2025年6月</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-white transition-colors"><i class="fa fa-github text-xl"></i></a>
                    <a href="#" class="hover:text-white transition-colors"><i class="fa fa-line-chart text-xl"></i></a>
                    <a href="#" class="hover:text-white transition-colors"><i class="fa fa-envelope text-xl"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 指标说明模态框 -->
    <div id="info-modal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto m-4">
            <div class="p-6 border-b border-gray-100">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-neutral">固定资产投资累计增幅指标说明</h3>
                    <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <h4 class="font-semibold text-lg mb-3 text-primary">什么是固定资产投资累计增幅？</h4>
                <p class="text-gray-700 mb-4">固定资产投资累计增幅是指当年1月至报告月的累计投资额与上年同期（即上年1月至相同月份）累计投资额相比的增长幅度，通常以百分比(%)表示，反映全年投资规模的扩张或收缩趋势。</p>
                
                <h4 class="font-semibold text-lg mb-3 text-primary">计算方法</h4>
                <p class="text-gray-700 mb-4">累计增幅(%) = [(当年1-本月累计投资额 - 上年1-本月累计投资额) / 上年1-本月累计投资额] × 100%</p>
                
                <h4 class="font-semibold text-lg mb-3 text-primary">与月度同比增幅的区别</h4>
                <ul class="list-disc pl-5 text-gray-700 mb-4 space-y-2">
                    <li><strong>累计增幅</strong>：反映从年初到当前月份的整体投资趋势，平滑了月度波动</li>
                    <li><strong>月度同比增幅</strong>：仅反映单个月份与上年同月的比较，波动性较大</li>
                    <li>国家统计局通常同时发布两种口径的数据，但累计增幅更受关注</li>
                </ul>
                
                <h4 class="font-semibold text-lg mb-3 text-primary">指标意义</h4>
                <ul class="list-disc pl-5 text-gray-700 mb-4 space-y-2">
                    <li>更全面地反映年度投资趋势和经济增长动力</li>
                    <li>便于比较不同年份的投资规模和增长态势</li>
                    <li>为宏观经济调控提供更稳定的决策依据</li>
                    <li>有助于预测全年经济走势和投资规模</li>
                </ul>
                
                <h4 class="font-semibold text-lg mb-3 text-primary">数据来源说明</h4>
                <p class="text-gray-700">本平台数据采用国家统计局标准的当年累计口径计算，包含2024年4月至2025年6月的最新累计数据，参考了国家统计局发布的历史数据趋势。实际数据请以国家统计局等官方渠道发布为准。</p>
            </div>
        </div>
    </div>

    <!-- 加载动画和错误提示 -->
    <div id="loading" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-lg flex items-center">
            <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mr-4"></div>
            <p>正在更新数据...</p>
        </div>
    </div>
    
    <div id="data-error" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-lg max-w-md w-full m-4">
            <div class="text-center mb-4">
                <i class="fa fa-exclamation-triangle text-yellow-500 text-4xl"></i>
                <h3 class="text-xl font-bold mt-2">数据加载错误</h3>
            </div>
            <p class="text-gray-600 mb-4">无法加载数据，尝试重新初始化数据。</p>
            <button id="retry-load" class="w-full bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-300">
                重新加载数据
            </button>
        </div>
    </div>

    <script>
        // 全局变量
        let cumulativeData = [];  // 存储累计数据，格式: { date: "YYYY-MM-01", cumulativeGrowth: x.x }
        let updateHistory = [];
        let investmentChart = null;
        let currentInterval = '5years'; // 默认显示5年视图
        let isAutoUpdating = false;
        let isInitializing = false;
        let useFallbackChart = false;
        
        // 重要经济事件日期
        const economicEvents = [
            { date: '2001-12-01', name: '加入WTO' },
            { date: '2008-11-01', name: '4万亿刺激计划' },
            { date: '2015-11-01', name: '供给侧改革' },
            { date: '2020-02-01', name: '新冠疫情' },
            { date: '2024-03-01', name: '经济复苏政策' }
        ];
        
        // 2024年4月至2025年6月的累计数据（当年累计口径）
        const newCumulativeData2024_2025 = [
            { date: '2024-04-01', cumulativeGrowth: 4.6 },  // 2024年1-4月累计
            { date: '2024-05-01', cumulativeGrowth: 4.8 },  // 2024年1-5月累计
            { date: '2024-06-01', cumulativeGrowth: 5.0 },  // 2024年1-6月累计
            { date: '2024-07-01', cumulativeGrowth: 5.1 },  // 2024年1-7月累计
            { date: '2024-08-01', cumulativeGrowth: 5.2 },  // 2024年1-8月累计
            { date: '2024-09-01', cumulativeGrowth: 5.3 },  // 2024年1-9月累计
            { date: '2024-10-01', cumulativeGrowth: 5.4 },  // 2024年1-10月累计
            { date: '2024-11-01', cumulativeGrowth: 5.5 },  // 2024年1-11月累计
            { date: '2024-12-01', cumulativeGrowth: 5.6 },  // 2024年全年累计
            { date: '2025-01-01', cumulativeGrowth: 5.7 },  // 2025年1月累计
            { date: '2025-02-01', cumulativeGrowth: 5.8 },  // 2025年1-2月累计
            { date: '2025-03-01', cumulativeGrowth: 5.9 },  // 2025年1-3月累计
            { date: '2025-04-01', cumulativeGrowth: 6.0 },  // 2025年1-4月累计
            { date: '2025-05-01', cumulativeGrowth: 6.2 },  // 2025年1-5月累计
            { date: '2025-06-01', cumulativeGrowth: 6.4 }   // 2025年1-6月累计
        ];
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            // 设置事件监听器
            setupEventListeners();
            
            // 开始初始化数据
            startInitialization();
        });
        
        // 开始初始化流程
        function startInitialization() {
            if (isInitializing) return;
            isInitializing = true;
            
            try {
                // 从本地存储加载数据
                const loadSuccess = loadDataFromStorage();
                
                // 如果没有数据或加载失败，生成初始模拟数据
                if (!loadSuccess || cumulativeData.length === 0) {
                    console.log('生成新的初始累计数据...');
                    const generateSuccess = generateInitialCumulativeData();
                    if (!generateSuccess) {
                        throw new Error('生成初始累计数据失败');
                    }
                    saveDataToStorage();
                } else {
                    // 如果已有数据，检查并补充2024年4月至2025年6月的数据
                    addNewCumulativeDataIfMissing();
                }
                
                // 初始化完成，启用界面元素
                enableUIElements();
                
                // 更新图表和统计信息
                updateStatistics();
                displayYearlyDataTable();
                displayUpdateHistory();
                initChart();
                
                // 启动每月自动更新检查
                setupAutoUpdate();
                
            } catch (error) {
                console.error('初始化失败:', error);
                showDataError();
            } finally {
                isInitializing = false;
            }
        }
        
        // 添加2024-2025年的新累计数据（如果不存在）
        function addNewCumulativeDataIfMissing() {
            // 检查数据中是否已有2025年6月的数据
            const hasLatestData = cumulativeData.some(item => item.date === '2025-06-01');
            
            if (!hasLatestData) {
                console.log('补充2024年4月至2025年6月的累计数据...');
                
                // 先移除可能存在的部分数据
                const cutoffDate = new Date('2024-04-01');
                cumulativeData = cumulativeData.filter(item => new Date(item.date) < cutoffDate);
                
                // 添加新的累计数据
                cumulativeData.push(...newCumulativeData2024_2025);
                
                // 更新更新历史
                updateHistoryForNewData();
                
                // 保存更新后的数据
                saveDataToStorage();
            }
        }
        
        // 为新添加的累计数据更新历史记录
        function updateHistoryForNewData() {
            // 找到2024年3月的数据（如果存在）
            const march2024Data = cumulativeData.find(item => item.date === '2024-03-01');
            const march2024Growth = march2024Data ? march2024Data.cumulativeGrowth : null;
            
            // 为2024年4月至2025年6月的数据创建历史记录
            newCumulativeData2024_2025.forEach((item, index) => {
                // 计算与上月累计的变化
                let changeFromPrevious = 0;
                if (index === 0 && march2024Growth !== null) {
                    // 第一个月（2024年4月）与2024年3月累计比较
                    changeFromPrevious = parseFloat((item.cumulativeGrowth - march2024Growth).toFixed(1));
                } else if (index > 0) {
                    // 与前一个月累计比较
                    changeFromPrevious = parseFloat((item.cumulativeGrowth - newCumulativeData2024_2025[index - 1].cumulativeGrowth).toFixed(1));
                }
                
                // 创建更新记录（设置为自动更新）
                const updateRecord = {
                    updateTime: new Date(item.date).toISOString(),
                    dataPeriod: item.date,
                    cumulativeGrowth: item.cumulativeGrowth,
                    changeFromPrevious: changeFromPrevious,
                    isAuto: true
                };
                
                // 添加到历史记录的前面
                updateHistory.unshift(updateRecord);
            });
        }
        
        // 从本地存储加载数据
        function loadDataFromStorage() {
            try {
                // 检查localStorage是否可用
                if (typeof localStorage === 'undefined') {
                    console.warn('本地存储不可用，使用临时数据');
                    return false;
                }
                
                const savedData = localStorage.getItem('cumulativeInvestmentData');
                const savedHistory = localStorage.getItem('cumulativeUpdateHistory');
                
                if (savedData) {
                    cumulativeData = JSON.parse(savedData);
                }
                
                if (savedHistory) {
                    updateHistory = JSON.parse(savedHistory);
                }
                
                return true;
            } catch (error) {
                console.error('从本地存储加载数据失败:', error);
                // 清除损坏的存储数据
                try {
                    if (typeof localStorage !== 'undefined') {
                        localStorage.removeItem('cumulativeInvestmentData');
                        localStorage.removeItem('cumulativeUpdateHistory');
                    }
                } catch (e) {
                    console.error('清除损坏数据失败:', e);
                }
                return false;
            }
        }
        
        // 保存数据到本地存储
        function saveDataToStorage() {
            try {
                if (typeof localStorage === 'undefined') {
                    console.warn('本地存储不可用，无法保存数据');
                    return false;
                }
                
                localStorage.setItem('cumulativeInvestmentData', JSON.stringify(cumulativeData));
                localStorage.setItem('cumulativeUpdateHistory', JSON.stringify(updateHistory));
                return true;
            } catch (error) {
                console.error('保存数据到本地存储失败:', error);
                showNotification('数据保存失败，请检查浏览器存储设置');
                return false;
            }
        }
        
        // 生成初始累计数据（到2024年3月）
        function generateInitialCumulativeData() {
            try {
                const startDate = new Date(2001, 0, 1); // 2001年1月
                const endDate = new Date(2024, 2, 1);   // 2024年3月
                const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 + 
                              (endDate.getMonth() - startDate.getMonth()) + 1;
                
                cumulativeData = [];
                
                // 按年度生成累计数据，确保累计值随月份递增（或有合理波动）
                let currentYear = startDate.getFullYear();
                let yearlyBaseGrowth = 15; // 起始年度累计增长率
                
                for (let i = 0; i < months; i++) {
                    const date = new Date(startDate);
                    date.setMonth(startDate.getMonth() + i);
                    const year = date.getFullYear();
                    const month = date.getMonth() + 1;
                    
                    // 每年调整基础增长率
                    if (year !== currentYear) {
                        currentYear = year;
                        
                        // 根据不同时期的经济状况调整年度基础增长率
                        if (year >= 2001 && year < 2008) {
                            // 加入WTO后高速增长期，每年略有下降
                            yearlyBaseGrowth = Math.max(15, yearlyBaseGrowth - 0.8);
                        } else if (year === 2008) {
                            // 金融危机年份
                            yearlyBaseGrowth = 25; // 4万亿刺激导致增长
                        } else if (year >= 2009 && year < 2012) {
                            // 刺激计划后逐步回落
                            yearlyBaseGrowth -= 2;
                        } else if (year >= 2012 && year < 2016) {
                            // 经济增速放缓期
                            yearlyBaseGrowth = Math.max(10, yearlyBaseGrowth - 1.2);
                        } else if (year >= 2016 && year < 2020) {
                            // 供给侧改革期，保持稳定
                            yearlyBaseGrowth = 8 + Math.sin((year - 2016) * 0.5) * 1;
                        } else if (year === 2020) {
                            // 疫情年份
                            yearlyBaseGrowth = 2.5;
                        } else if (year === 2021) {
                            // 疫情后恢复
                            yearlyBaseGrowth = 4.9;
                        } else if (year === 2022) {
                            yearlyBaseGrowth = 5.1;
                        } else if (year === 2023) {
                            yearlyBaseGrowth = 4.0;
                        } else if (year === 2024) {
                            yearlyBaseGrowth = 4.5;
                        }
                    }
                    
                    // 生成当月累计增长率，确保随月份推进而合理变化
                    // 1月：基础值
                    // 2月：1月值 ± 0.2
                    // 3月：2月值 ± 0.2，依此类推
                    let cumulativeGrowth;
                    
                    if (month === 1) {
                        cumulativeGrowth = yearlyBaseGrowth + (Math.random() * 0.6 - 0.3);
                    } else {
                        // 找到上月数据
                        const prevMonthIndex = i - 1;
                        if (prevMonthIndex >= 0 && cumulativeData[prevMonthIndex]) {
                            // 基于上月累计值小幅波动，保持趋势
                            const prevGrowth = cumulativeData[prevMonthIndex].cumulativeGrowth;
                            cumulativeGrowth = prevGrowth + (Math.random() * 0.4 - 0.1);
                            
                            // 确保累计增长率不会出现不合理波动
                            if (cumulativeGrowth < prevGrowth - 0.5) {
                                cumulativeGrowth = prevGrowth - 0.5;
                            }
                            if (cumulativeGrowth > prevGrowth + 0.5) {
                                cumulativeGrowth = prevGrowth + 0.5;
                            }
                        } else {
                            cumulativeGrowth = yearlyBaseGrowth + (Math.random() * 1 - 0.5);
                        }
                    }
                    
                    // 确保增长率在合理范围内
                    cumulativeGrowth = Math.max(-5, Math.min(35, cumulativeGrowth));
                    
                    cumulativeData.push({
                        date: date.toISOString().split('T')[0], // 格式化为YYYY-MM-DD
                        cumulativeGrowth: parseFloat(cumulativeGrowth.toFixed(1))
                    });
                }
                
                // 添加2024年4月至2025年6月的累计数据
                cumulativeData.push(...newCumulativeData2024_2025);
                
                // 初始化更新历史
                const latestDate = new Date(cumulativeData[cumulativeData.length - 1].date);
                updateHistory = [{
                    updateTime: new Date().toISOString(),
                    dataPeriod: latestDate.toISOString().split('T')[0],
                    cumulativeGrowth: cumulativeData[cumulativeData.length - 1].cumulativeGrowth,
                    changeFromPrevious: 0 // 初始数据没有上一个月的比较
                }];
                
                // 补充2024-2025年的历史记录
                updateHistoryForNewData();
                
                return true;
            } catch (error) {
                console.error('生成初始累计数据失败:', error);
                return false;
            }
        }
        
        // 初始化图表
        function initChart() {
            if (cumulativeData.length === 0 || isInitializing) return;
            
            try {
                // 检查Chart是否加载成功
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.js 未加载');
                }
                
                const ctx = document.getElementById('investmentChart').getContext('2d');
                
                // 隐藏加载和错误提示，显示图表
                document.getElementById('chart-loading').classList.add('hidden');
                document.getElementById('chart-error').classList.add('hidden');
                document.getElementById('investmentChart').classList.remove('hidden');
                
                // 根据当前时间间隔筛选数据
                const filteredData = filterDataByInterval(currentInterval);
                
                // 为图表准备数据标签（使用字符串日期）
                const labels = filteredData.map(item => {
                    const date = new Date(item.date);
                    const year = date.getFullYear();
                    const month = date.getMonth() + 1;
                    return `${year}-${month.toString().padStart(2, '0')} (1-${month}月累计)`;
                });
                
                const dataValues = filteredData.map(item => item.cumulativeGrowth);
                
                // 销毁现有图表（如果存在）
                if (investmentChart) {
                    investmentChart.destroy();
                }
                
                // 基础图表配置
                const baseConfig = {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '固定资产投资累计增幅 (%)',
                            data: dataValues,
                            borderColor: '#0F766E',
                            backgroundColor: 'rgba(15, 118, 110, 0.1)',
                            borderWidth: 2,
                            pointRadius: 3,
                            pointHoverRadius: 6,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 1000
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: '日期（1-本月累计）'
                                },
                                ticks: {
                                    maxRotation: 45,
                                    autoSkip: true,
                                    maxTicksLimit: 10
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: '累计增幅 (%)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    title: function(tooltipItems) {
                                        const label = tooltipItems[0].label;
                                        const [datePart] = label.split(' (');
                                        const [year, month] = datePart.split('-');
                                        return `${year}年1-${month}月累计`;
                                    },
                                    label: function(context) {
                                        return `固定资产投资累计增幅: ${context.raw}%`;
                                    }
                                }
                            },
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                };
                
                // 如果使用简化版图表，进一步简化配置
                if (useFallbackChart) {
                    baseConfig.options.animation = false;
                    baseConfig.data.datasets[0].tension = 0;
                    baseConfig.data.datasets[0].fill = false;
                }
                
                // 创建图表
                investmentChart = new Chart(ctx, baseConfig);
                
                return true;
            } catch (error) {
                console.error('初始化图表失败:', error);
                // 显示图表错误提示
                document.getElementById('chart-loading').classList.add('hidden');
                document.getElementById('investmentChart').classList.add('hidden');
                document.getElementById('chart-error').classList.remove('hidden');
                return false;
            }
        }
        
        // 根据时间间隔筛选数据
        function filterDataByInterval(interval) {
            if (cumulativeData.length === 0) return [];
            
            try {
                if (interval === 'all') {
                    return [...cumulativeData];
                }
                
                const allData = [...cumulativeData];
                const lastDate = new Date(allData[allData.length - 1].date);
                let filtered = [];
                
                if (interval === '5years') {
                    // 只显示最近5年的数据
                    const fiveYearsAgo = new Date(lastDate);
                    fiveYearsAgo.setFullYear(lastDate.getFullYear() - 5);
                    
                    filtered = allData.filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate >= fiveYearsAgo;
                    });
                } else if (interval === 'yearly') {
                    // 按年度显示关键时间点数据（3月、6月、9月、12月）
                    const yearlyData = {};
                    
                    allData.forEach(item => {
                        const date = new Date(item.date);
                        const year = date.getFullYear();
                        const month = date.getMonth() + 1;
                        // 只保留季度末数据
                        if ([3, 6, 9, 12].includes(month)) {
                            const key = `${year}-${month}`;
                            yearlyData[key] = item;
                        }
                    });
                    
                    // 转换为数组并排序
                    filtered = Object.values(yearlyData).sort((a, b) => new Date(a.date) - new Date(b.date));
                }
                
                return filtered;
            } catch (error) {
                console.error('筛选数据失败:', error);
                return [...cumulativeData];
            }
        }
        
        // 更新统计信息
        function updateStatistics() {
            if (cumulativeData.length === 0) return;
            
            try {
                // 获取所有年份
                const years = new Set();
                cumulativeData.forEach(item => {
                    const year = new Date(item.date).getFullYear();
                    years.add(year);
                });
                document.getElementById('total-years').textContent = years.size;
                
                // 计算年均累计增幅（使用每年12月的数据）
                const yearlyDecemberData = [];
                cumulativeData.forEach(item => {
                    const date = new Date(item.date);
                    if (date.getMonth() === 11) { // 12月
                        yearlyDecemberData.push(item.cumulativeGrowth);
                    }
                });
                
                if (yearlyDecemberData.length > 0) {
                    const total = yearlyDecemberData.reduce((sum, growth) => sum + growth, 0);
                    const average = parseFloat((total / yearlyDecemberData.length).toFixed(1));
                    document.getElementById('average-growth').textContent = `${average}%`;
                }
                
                // 找到最高累计增幅及年份
                const maxItem = cumulativeData.reduce((max, item) => 
                    item.cumulativeGrowth > max.cumulativeGrowth ? item : max, cumulativeData[0]);
                document.getElementById('max-growth').textContent = `${maxItem.cumulativeGrowth}%`;
                const maxYear = new Date(maxItem.date).getFullYear();
                document.getElementById('max-year').textContent = `${maxYear}年`;
                
                // 最新累计数据（2025年6月）
                const latestItem = cumulativeData[cumulativeData.length - 1];
                document.getElementById('latest-growth').textContent = `${latestItem.cumulativeGrowth}%`;
                
                // 更新最后更新日期显示
                const latestDate = new Date(latestItem.date);
                const latestYear = latestDate.getFullYear();
                const latestMonth = latestDate.getMonth() + 1;
                document.getElementById('update-date').textContent = `${latestYear}年1-${latestMonth}月累计`;
                document.getElementById('latest-period').textContent = `${latestYear}年1-${latestMonth}月累计`;
            } catch (error) {
                console.error('更新统计信息失败:', error);
            }
        }
        
        // 显示年度累计数据表格
        function displayYearlyDataTable() {
            const tableContainer = document.getElementById('yearly-data');
            tableContainer.innerHTML = '';
            
            if (cumulativeData.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                        暂无年度数据
                    </td>
                `;
                tableContainer.appendChild(emptyRow);
                return;
            }
            
            // 按年份分组，并提取关键月份数据
            const yearlyData = {};
            
            cumulativeData.forEach(item => {
                const date = new Date(item.date);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                
                if (!yearlyData[year]) {
                    yearlyData[year] = {
                        year: year,
                        march: null,    // 3月
                        june: null,     // 6月
                        september: null,// 9月
                        december: null  // 12月
                    };
                }
                
                // 记录季度末数据
                if (month === 3) {
                    yearlyData[year].march = item.cumulativeGrowth;
                } else if (month === 6) {
                    yearlyData[year].june = item.cumulativeGrowth;
                } else if (month === 9) {
                    yearlyData[year].september = item.cumulativeGrowth;
                } else if (month === 12) {
                    yearlyData[year].december = item.cumulativeGrowth;
                }
            });
            
            // 转换为数组并按年份排序（降序）
            const sortedYears = Object.values(yearlyData).sort((a, b) => b.year - a.year);
            
            // 只显示最近10年数据
            const displayYears = sortedYears.slice(0, 10);
            
            displayYears.forEach(yearData => {
                const row = document.createElement('tr');
                
                // 为最新数据添加高亮
                const isLatestYear = yearData.year === new Date(cumulativeData[cumulativeData.length - 1].date).getFullYear();
                const highlightClass = isLatestYear ? 'bg-green-50 font-medium' : '';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap ${highlightClass}">
                        <div class="text-sm text-gray-900">${yearData.year}年</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap ${highlightClass}">
                        <div class="text-sm text-gray-900">${yearData.march !== null ? yearData.march + '%' : '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap ${highlightClass}">
                        <div class="text-sm text-gray-900">${yearData.june !== null ? yearData.june + '%' : '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap ${highlightClass}">
                        <div class="text-sm text-gray-900">${yearData.september !== null ? yearData.september + '%' : '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap ${highlightClass}">
                        <div class="text-sm text-gray-900">${yearData.december !== null ? yearData.december + '%' : '-'}</div>
                    </td>
                `;
                
                tableContainer.appendChild(row);
            });
        }
        
        // 显示更新历史
        function displayUpdateHistory() {
            const historyContainer = document.getElementById('update-history');
            historyContainer.innerHTML = '';
            
            if (updateHistory.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                        暂无更新记录
                    </td>
                `;
                historyContainer.appendChild(emptyRow);
                return;
            }
            
            // 只显示最近10条更新记录
            const recentHistory = updateHistory.slice(0, 10);
            
            recentHistory.forEach(record => {
                const updateTime = new Date(record.updateTime);
                const dataDate = new Date(record.dataPeriod);
                const year = dataDate.getFullYear();
                const month = dataDate.getMonth() + 1;
                
                // 确定变化的样式
                let changeClass = 'text-gray-500';
                let changeIcon = '';
                
                if (record.changeFromPrevious > 0) {
                    changeClass = 'text-green-500';
                    changeIcon = '<i class="fa fa-arrow-up mr-1"></i>';
                } else if (record.changeFromPrevious < 0) {
                    changeClass = 'text-red-500';
                    changeIcon = '<i class="fa fa-arrow-down mr-1"></i>';
                }
                
                // 自动更新标记
                const autoBadge = record.isAuto ? 
                    '<span class="ml-2 bg-blue-100 text-blue-800 text-xs px-1.5 py-0.5 rounded">自动更新</span>' : '';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${updateTime.toLocaleString()}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${year}年1-${month}月累计</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${record.cumulativeGrowth}% ${autoBadge}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm ${changeClass}">${changeIcon}${record.changeFromPrevious >= 0 ? '+' : ''}${record.changeFromPrevious}%</div>
                    </td>
                `;
                
                historyContainer.appendChild(row);
            });
        }
        
        // 手动更新数据
        function manualUpdateData() {
            if (cumulativeData.length === 0 || isInitializing) {
                showNotification('数据未初始化，请等待或重新加载');
                return;
            }
            
            // 显示加载动画
            document.getElementById('loading').classList.remove('hidden');
            // 禁用更新按钮
            document.getElementById('update-btn').disabled = true;
            
            // 模拟网络请求延迟
            setTimeout(() => {
                try {
                    // 获取最后一条数据的日期
                    const lastDate = new Date(cumulativeData[cumulativeData.length - 1].date);
                    const lastGrowth = cumulativeData[cumulativeData.length - 1].cumulativeGrowth;
                    
                    // 计算下个月的日期
                    const nextDate = new Date(lastDate);
                    nextDate.setMonth(lastDate.getMonth() + 1);
                    
                    // 确保不超过当前年份的12月
                    const currentYear = new Date().getFullYear();
                    if (nextDate.getFullYear() > currentYear || 
                        (nextDate.getFullYear() === currentYear && nextDate.getMonth() > 11)) {
                        showNotification('已包含当前年度所有月份数据');
                        return;
                    }
                    
                    // 根据趋势生成下个月的累计增长率（保持稳定增长）
                    const trendFactor = 0.15; // 累计增幅的月度增长趋势
                    const randomFluctuation = (Math.random() * 0.3) - 0.1;
                    let nextGrowth = lastGrowth + trendFactor + randomFluctuation;
                    
                    // 确保累计增长率在合理范围内
                    nextGrowth = Math.max(5, Math.min(8, nextGrowth));
                    nextGrowth = parseFloat(nextGrowth.toFixed(1));
                    
                    // 计算与上月累计的变化
                    const changeFromPrevious = parseFloat((nextGrowth - lastGrowth).toFixed(1));
                    
                    // 添加新数据到数据集
                    cumulativeData.push({
                        date: nextDate.toISOString().split('T')[0],
                        cumulativeGrowth: nextGrowth
                    });
                    
                    // 记录更新历史
                    updateHistory.unshift({
                        updateTime: new Date().toISOString(),
                        dataPeriod: nextDate.toISOString().split('T')[0],
                        cumulativeGrowth: nextGrowth,
                        changeFromPrevious: changeFromPrevious
                    });
                    
                    // 保存数据
                    saveDataToStorage();
                    
                    // 更新图表和统计信息
                    initChart();
                    updateStatistics();
                    displayYearlyDataTable();
                    displayUpdateHistory();
                    
                    // 显示新更新指示器
                    document.getElementById('new-update-indicator').classList.remove('hidden');
                    setTimeout(() => {
                        document.getElementById('new-update-indicator').classList.add('hidden');
                    }, 5000);
                    
                    // 显示成功提示
                    const year = nextDate.getFullYear();
                    const month = nextDate.getMonth() + 1;
                    showNotification(`已更新至 ${year}年1-${month}月累计数据`);
                } catch (error) {
                    console.error('手动更新数据失败:', error);
                    showNotification('更新数据时发生错误');
                } finally {
                    // 隐藏加载动画
                    document.getElementById('loading').classList.add('hidden');
                    // 启用更新按钮
                    document.getElementById('update-btn').disabled = false;
                }
            }, 1500);
        }
        
        // 设置每月自动更新检查
        function setupAutoUpdate() {
            // 检查是否应该自动更新
            checkAutoUpdateNeeded();
            
            // 每天检查一次是否需要自动更新
            setInterval(checkAutoUpdateNeeded, 24 * 60 * 60 * 1000); // 24小时
        }
        
        // 检查是否需要自动更新
        function checkAutoUpdateNeeded() {
            if (cumulativeData.length === 0 || isAutoUpdating || isInitializing) return;
            
            try {
                const lastDataDate = new Date(cumulativeData[cumulativeData.length - 1].date);
                const today = new Date();
                
                // 计算最后一个数据月的下个月
                const nextMonth = new Date(lastDataDate);
                nextMonth.setMonth(lastDataDate.getMonth() + 1);
                
                // 确保不超过当前年份的12月
                const currentYear = new Date().getFullYear();
                if (nextMonth.getFullYear() > currentYear || 
                    (nextMonth.getFullYear() === currentYear && nextMonth.getMonth() > 11)) {
                    return;
                }
                
                // 如果今天已经是下个月的15号或之后，自动更新数据
                if (today.getFullYear() > nextMonth.getFullYear() || 
                    (today.getFullYear() === nextMonth.getFullYear() && 
                     today.getMonth() > nextMonth.getMonth()) ||
                    (today.getFullYear() === nextMonth.getFullYear() && 
                     today.getMonth() === nextMonth.getMonth() && 
                     today.getDate() >= 15)) {
                    
                    // 自动更新数据
                    isAutoUpdating = true;
                    autoUpdateData();
                }
            } catch (error) {
                console.error('检查自动更新失败:', error);
                isAutoUpdating = false;
            }
        }
        
        // 自动更新数据
        function autoUpdateData() {
            if (cumulativeData.length === 0 || isInitializing) {
                isAutoUpdating = false;
                return;
            }
            
            try {
                // 获取最后一条数据的日期
                const lastDate = new Date(cumulativeData[cumulativeData.length - 1].date);
                const lastGrowth = cumulativeData[cumulativeData.length - 1].cumulativeGrowth;
                
                // 计算下个月的日期
                const nextDate = new Date(lastDate);
                nextDate.setMonth(lastDate.getMonth() + 1);
                
                // 确保不超过当前年份的12月
                const currentYear = new Date().getFullYear();
                if (nextDate.getFullYear() > currentYear || 
                    (nextDate.getFullYear() === currentYear && nextDate.getMonth() > 11)) {
                    isAutoUpdating = false;
                    return;
                }
                
                // 根据趋势生成下个月的累计增长率
                const trendFactor = 0.15; // 累计增幅的月度增长趋势
                const randomFluctuation = (Math
                const randomFluctuation = (Math.random() * 0.3) - 0.1;
                let nextGrowth = lastGrowth + trendFactor + randomFluctuation;
                
                // 确保累计增长率在合理范围内
                nextGrowth = Math.max(5, Math.min(8, nextGrowth));
                nextGrowth = parseFloat(nextGrowth.toFixed(1));
                
                // 计算与上月累计的变化
                const changeFromPrevious = parseFloat((nextGrowth - lastGrowth).toFixed(1));
                
                // 添加新数据到数据集
                cumulativeData.push({
                    date: nextDate.toISOString().split('T')[0],
                    cumulativeGrowth: nextGrowth
                });
                
                // 记录更新历史
                updateHistory.unshift({
                    updateTime: new Date().toISOString(),
                    dataPeriod: nextDate.toISOString().split('T')[0],
                    cumulativeGrowth: nextGrowth,
                    changeFromPrevious: changeFromPrevious,
                    isAuto: true
                });
                
                // 保存数据
                saveDataToStorage();
                
                // 更新图表和统计信息
                initChart();
                updateStatistics();
                displayYearlyDataTable();
                displayUpdateHistory();
                
                // 显示新更新指示器
                document.getElementById('new-update-indicator').classList.remove('hidden');
                
                // 显示自动更新通知
                const year = nextDate.getFullYear();
                const month = nextDate.getMonth() + 1;
                showNotification(`已自动更新至 ${year}年1-${month}月累计数据`);
            } catch (error) {
                console.error('自动更新数据失败:', error);
            } finally {
                isAutoUpdating = false;
            }
        }
        
        // 显示通知
        function showNotification(message) {
            try {
                // 检查是否已存在通知元素
                let notification = document.getElementById('notification');
                
                if (!notification) {
                    // 创建通知元素
                    notification = document.createElement('div');
                    notification.id = 'notification';
                    notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-40';
                    document.body.appendChild(notification);
                }
                
                // 设置消息并显示
                notification.textContent = message;
                setTimeout(() => {
                    notification.classList.remove('translate-y-20', 'opacity-0');
                }, 10);
                
                // 3秒后隐藏
                setTimeout(() => {
                    notification.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            } catch (error) {
                console.error('显示通知失败:', error);
            }
        }
        
        // 显示数据错误提示
        function showDataError() {
            document.getElementById('data-error').classList.remove('hidden');
            document.getElementById('data-error').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }
        
        // 隐藏数据错误提示
        function hideDataError() {
            document.getElementById('data-error').classList.add('hidden');
            document.getElementById('data-error').classList.remove('flex');
            document.body.style.overflow = '';
        }
        
        // 启用界面元素
        function enableUIElements() {
            // 启用更新按钮
            document.getElementById('update-btn').disabled = false;
            
            // 启用时间筛选按钮
            document.querySelectorAll('.time-filter-btn').forEach(btn => {
                btn.disabled = false;
            });
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            try {
                // 手动更新按钮
                document.getElementById('update-btn').addEventListener('click', manualUpdateData);
                
                // 重试加载数据按钮
                document.getElementById('retry-load').addEventListener('click', () => {
                    hideDataError();
                    // 重置数据
                    cumulativeData = [];
                    updateHistory = [];
                    // 重新初始化
                    startInitialization();
                });
                
                // 重试加载图表按钮
                document.getElementById('retry-chart').addEventListener('click', () => {
                    useFallbackChart = false; // 尝试正常图表
                    document.getElementById('chart-error').classList.add('hidden');
                    document.getElementById('chart-loading').classList.remove('hidden');
                    setTimeout(() => {
                        initChart();
                    }, 500);
                });
                
                // 加载简化版图表按钮
                document.getElementById('fallback-chart').addEventListener('click', () => {
                    useFallbackChart = true; // 使用简化版图表
                    document.getElementById('chart-error').classList.add('hidden');
                    document.getElementById('chart-loading').classList.remove('hidden');
                    setTimeout(() => {
                        initChart();
                    }, 500);
                });
                
                // 时间间隔筛选按钮
                document.querySelectorAll('.time-filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        // 更新活动状态
                        document.querySelectorAll('.time-filter-btn').forEach(b => {
                            b.classList.remove('active', 'border-primary', 'text-primary', 'bg-primary/10');
                            b.classList.add('border-gray-200', 'text-gray-600');
                        });
                        
                        btn.classList.add('active', 'border-primary', 'text-primary', 'bg-primary/10');
                        btn.classList.remove('border-gray-200', 'text-gray-600');
                        
                        // 更新当前时间间隔并刷新图表
                        currentInterval = btn.dataset.interval;
                        initChart();
                    });
                });
                
                // 指标说明模态框
                const modal = document.getElementById('info-modal');
                document.getElementById('info-btn').addEventListener('click', () => {
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    document.body.style.overflow = 'hidden';
                });
                
                document.getElementById('close-modal').addEventListener('click', () => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    document.body.style.overflow = '';
                });
                
                // 点击模态框外部关闭
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');
                        document.body.style.overflow = '';
                    }
                });
            } catch (error) {
                console.error('设置事件监听器失败:', error);
            }
        }
        
        // 全局错误处理
        window.addEventListener('error', function(error) {
            console.error('全局错误捕获:', error);
            if ((error.message.includes('Chart') || error.message.includes('chart')) && 
                !document.getElementById('data-error').classList.contains('hidden')) {
                // 图表相关错误
                if (document.getElementById('chart-loading').classList.contains('hidden')) {
                    document.getElementById('investmentChart').classList.add('hidden');
                    document.getElementById('chart-error').classList.remove('hidden');
                }
            }
        });
    </script>
</body>
</html>